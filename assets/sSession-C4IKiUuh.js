import{R as m,I as d,c as u,X as p,Y as k,Z as f,_ as h,k as s}from"./index-C-U8uR4l.js";import{a as C,G as v}from"./axios-U3mhuuG9.js";const c=document.createElement("script");c.src=`${m}${d}`;document.body.appendChild(c);const I=u()(p(k((r,l)=>({alias:"",nombre:"",token:"",permisos:[],tokenValid:!1,authorized:!0,setSesion:async(e,a)=>{try{await new Promise(o=>{const n=setInterval(()=>{window.grecaptcha&&window.grecaptcha.enterprise&&(clearInterval(n),o(""))},100)});const t=await window.grecaptcha.enterprise.execute(d,{action:"autenticacion/v2/login"}),i=await C.post(`${f}/${h}`,{usuario:e,contrasena:a,tokenReCAPTCHA:t},{headers:{accept:"text/plain","Content-Type":"application/json"}});if(i.data.status){const o=i.data;r(n=>({...n,alias:o.data.alias,nombre:o.data.nombre,permisos:o.data.permisos,token:o.data.token,tokenValid:!0,authorized:!0}),!1,"IniciarSesion"),v("hidden"),s.success(`¡Hola ${o.data.nombre}! Nos alegra verte de nuevo. ¿Cuantas boletas venderás hoy?`)}else s.error("Error en la solicitud, informa al administrador por favor.")}catch(t){"errors"in t.response.data?s.error(t.response.data.errors.join(", ")):s.warning("Error en la solicitud. Por favor, intenta nuevamente más tarde.")}},setTokenValid:e=>{r(a=>({...a,alias:"",token:"",nombre:"",permisos:[],authorized:!1,tokenValid:e}),!1,"CerrarSesion"),l()},setAuthorized:e=>{r(a=>({...a,authorized:e}),!1,"DenegarSeccion")},updateSesion:e=>{r(a=>({...a,alias:e.alias,token:e.token,nombre:e.nombre,permisos:e.permisos,tokenValid:e.tokenValid}),!1,"CerrarSesion")}}),{name:"usuario"})));export{I as u};
