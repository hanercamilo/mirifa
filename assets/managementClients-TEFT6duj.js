import{c as Ke,A as je,r as s,u as Ye,j as e,N as ge,$ as Ze,F as z,f as et,a as tt,b as st,d as at,e as rt}from"./index-Cfzuxuk1.js";import{u as lt}from"./sSite-DJQJ7LAU.js";import{a as Ce,u as pe}from"./sSession-BvUv9zsA.js";import{D as X}from"./dialog-CK8NdMSH.js";import{b as it,d as nt,F as ot,B as ct,N as dt,S as u,a as be}from"./odata-2CVUwsId.js";import{c as ye}from"./concatenateErrors-CCuSbzXI.js";import"./gestionarBadge-CyfLsFJC.js";/* empty css              */const ut=Ke()((i,o)=>({totalCount:0,count:0,value:[],setClientsData:(r,d,c)=>(i(x=>({...x,totalCount:r,count:d,value:c})),o(),Promise.resolve()),cleanClients:async()=>{i(r=>({...r,totalCount:0,count:0,value:[]}),!1)}})),xt=async({...i})=>{const o=it(i.filter),r={...nt,table:"odata/Clientes",filter:o?`?$filter=${o}`:"",topCount:o?"&$count=true":`?$count=true&$top=${i.pageSize}&$skip=${i.currentPage*i.pageSize}`,orderBy:"&$orderBy=nombre asc"},d=`${r.table}${r.select}${r.expand}${r.filter}${r.apply}${r.topCount}${r.orderBy}`;var x=await ot(i.token,d,"Clientes_Listar");const m=x,R=m["@odata.count"];return await i.setClientsData(R??0,m.value.length,m.value),x},mt=async(i,o,r,d,c)=>(await Ce.patch(`${je}/api/Clientes/${i}/ActualizarInformacion`,{NombreCliente:o,DireccionCliente:r,EstadoCliente:d},{headers:{accept:"text/plain","Content-Type":"application/json",Authorization:c,Permiso:"Clientes_Actualizar"}})).data,ft=async(i,o,r,d,c)=>(await Ce.post(`${je}/api/Clientes/Crear`,{Telefono:i,NombreCliente:o,DireccionCliente:r,EstadoCliente:d},{headers:{accept:"text/plain","Content-Type":"application/json",Authorization:c,Permiso:"Clientes_Crear"}})).data;function ht(){const[i,o]=s.useState(0),[r,d]=s.useState(0),[c,x]=s.useState(5),[m,R]=s.useState(""),[ve,we]=s.useState(!1),P=10,{totalCount:V,count:J,value:I,setClientsData:Ne}=ut(t=>({totalCount:t.totalCount,count:t.count,value:t.value,setClientsData:t.setClientsData??(async(l,v,w)=>Promise.resolve())})),[N,ke]=s.useState({telefono:"",nombre:"",direccion:"",estadoRegistro:""}),[T,Ee]=s.useState({telefono:"",nombre:"",direccion:"",estadoRegistro:""}),[f,q]=s.useState([]),{setManagementVisited:Se}=lt(t=>({setManagementVisited:t.setManagementVisited})),n=pe(t=>t),[Ae,Fe]=s.useState(!0),[De,K]=s.useState(!0);s.useEffect(()=>{L=Math.ceil((f.length!=0?1:V)/c)},[f]);let L=Math.ceil((f.length!=0?1:V)/c);const h=Math.floor(r/P)*P,ze=Math.min(h+P,L),Te=["Clientes","Administrar","Listar clientes"],$e=pe(t=>t.permisos),Y=t=>$e.findIndex(l=>l==t)>0,[g,B]=s.useState(""),[p,H]=s.useState(""),[b,M]=s.useState(""),[y,_]=s.useState(""),[Re,$]=s.useState(!1),[Pe,Z]=s.useState(!0),[Ve,ee]=s.useState(!0),[Ie,te]=s.useState(!0),se=["","Activo","Inactivo"],{showDialog:ae,setShowDialog:qe}=Ye(t=>({showDialog:t.showDialog,setShowDialog:t.setShowDialog})),[re,O]=s.useState(!1),[le,U]=s.useState(!1),[ie,Q]=s.useState(!1),[k,ne]=s.useState(""),[j,oe]=s.useState(""),[E,ce]=s.useState(""),[S,de]=s.useState(""),[A,ue]=s.useState(""),[C,xe]=s.useState(""),[F,me]=s.useState(""),[Le,fe]=s.useState("");s.useEffect(()=>(ae==!1&&(O(!1),U(!1),Q(!1)),()=>{}),[ae]);const Be=()=>{O(!0)},He=t=>{ke({telefono:t.telefono,nombre:t.nombre,direccion:t.direccion,estadoRegistro:t.estadoRegistro}),U(!0)},Me=()=>{Ee({telefono:"",nombre:"",direccion:"",estadoRegistro:""}),Q(!0)};s.useEffect(()=>{ne(N.telefono),oe(N.nombre),ce(N.direccion),de(N.estadoRegistro)},[N]),s.useEffect(()=>{ue(T.telefono),xe(T.nombre),me(T.direccion),fe("Activo")},[T]);const[_e,Oe]=s.useState(!0),W=t=>{d(t)};s.useEffect(()=>((async()=>{try{K(!0);const l={currentPage:r,pageSize:c,token:n.token,filter:f,setClientsData:Ne};await xt({...l}),K(!1)}catch(l){l.message==="Forbidden"&&n.setAuthorized(!1),l.message==="Unauthorized"&&n.setTokenValid(!1),l.message}})(),()=>{}),[r,c,n.token,f,i]),s.useEffect(()=>()=>{},[I]);const Ue=t=>{d(0),x(parseInt(t.target.value))},Qe=t=>{R(t.target.value)};s.useEffect(()=>{g!=""||p!=""||y!=""||b!=""?($(!0),Z(!1)):($(!1),Z(!0))},[g,p,y,b]),s.useEffect(()=>{k==""||E==""||j==""||S==""?ee(!0):ee(!1)},[k,E,j,S]),s.useEffect(()=>{A==""||F==""||C==""?te(!0):te(!1)},[A,F,C]);const he=()=>{B(""),H(""),M(""),_(""),q([]),$(!1),O(!1),U(!1),Q(!1),qe(!1)},We=async()=>{let t=[];return g&&t.push({key:"telefono",value:g,type:"string",contains:!0}),p&&t.push({key:"nombre",value:p,type:"string",contains:!0}),b&&t.push({key:"direccion",value:b,type:"string",contains:!0}),y&&t.push({key:"estadoRegistro",value:y,type:"string",contains:!1}),q(t),""},Ge=()=>{we(!1)},Xe=async()=>{var t,l,v,w,D;if(k.length!=10)return"El teléfono del cliente no es válido.";if(!j.includes(" ")||j.trim()=="")return"El nombre del cliente debe incluir al menos un nombre y un apellido.";if(E.trim()=="")return"La dirección del cliente es requerida.";if(S=="")return"El estado del cliente es requerido.";try{const a=await mt(k,j,E,S,n.token);return a.errors==null?(o(G=>G+1),""):a.data!=null&&!a.errors?a.data:ye(a)}catch(a){return((t=a==null?void 0:a.response)==null?void 0:t.status)===403&&n.setAuthorized(!1),((l=a==null?void 0:a.response)==null?void 0:l.status)===401&&n.setTokenValid(!1),(v=a==null?void 0:a.response)==null||v.status,console.error("Error actualizando datos del cliente:",a),"Error actualizando los datos del cliente: "+((D=(w=a==null?void 0:a.response)==null?void 0:w.data)==null?void 0:D.errors)}},Je=async()=>{var t,l,v,w,D;if(A.length!=10)return"El teléfono del cliente no es válido.";if(!C.includes(" ")||C.trim()=="")return"El nombre del cliente debe incluir al menos un nombre y un apellido.";if(F.trim()=="")return"La dirección del cliente es requerida.";fe("Activo");try{const a=await ft(A,C,F,Le,n.token);return a.errors==null?(q([]),$(!1),B(""),H(""),M(""),_(""),o(G=>G+1),""):a.data!=null&&!a.errors?a.data:ye(a)}catch(a){return((t=a==null?void 0:a.response)==null?void 0:t.status)===403&&n.setAuthorized(!1),((l=a==null?void 0:a.response)==null?void 0:l.status)===401&&n.setTokenValid(!1),(v=a==null?void 0:a.response)==null||v.status,console.error("Error durante la creación del cliente:",a),"Error durante la creación del cliente: "+((D=(w=a==null?void 0:a.response)==null?void 0:w.data)==null?void 0:D.errors)}};return s.useEffect(()=>{n.token?n.authorized||(Se("/administracion/inicio"),Fe(!1)):Oe(!1)},[n]),_e?Ae?e.jsxs("div",{className:"",children:[e.jsx("header",{className:"bg-indigo-50 dark:bg-gray-800 mb-4 rounded-lg p-2 ml-0 max-w-full h-14",children:e.jsxs("div",{className:"ml-2 mx-auto flex justify-start",children:[e.jsx("a",{className:"text-2xl font-bold tracking-tight text-indigo-600",children:"Clientes del sistema"}),De&&e.jsx("div",{className:"align-middle -mt-0 -ml-8",children:e.jsx(Ze,{width:"80",color:"#4F46E5"})})]})}),J>0||f.length==0?e.jsx("div",{className:"w-full justify-center",children:e.jsxs("section",{className:"container px-4",id:"section2",children:[e.jsxs("div",{className:"flex justify-between items-center mt-3",children:[e.jsx(ct,{childs:Te},"breadCrumb"),e.jsxs("div",{className:"flex items-center gap-x-3",children:[e.jsxs("span",{className:"px-3 py-1 text-sm text-blue-600 bg-blue-100 rounded-full font-bold dark:bg-gray-800 dark:text-blue-400",children:["Items: ",J," / ",V]}),f.length==0&&e.jsxs("div",{className:"relative",children:[e.jsxs("select",{className:"cursor-pointer block appearance-none bg-white border border-gray-300 dark:bg-gray-800 dark:border-gray-700 text-gray-700 dark:text-gray-300 py-2 pl-3 pr-10 rounded-md leading-tight focus:outline-none focus:border-blue-300 dark:focus:border-blue-700 hover:border-blue-400",value:c,onChange:Ue,children:[e.jsx("option",{value:"5",children:"5 registros"}),e.jsx("option",{value:"25",children:"25 registros"}),e.jsx("option",{value:"50",children:"50 registros"})]}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700 dark:text-gray-300",children:e.jsx(z,{icon:et,className:"text-gray-400 "})})]}),Y("Clientes_Crear")&&e.jsxs("span",{className:"px-3 py-1 text-sm text-white bg-indigo-500 rounded-xl font-bold dark:bg-gray-800 dark:text-blue-400 cursor-pointer",onClick:Me,children:[e.jsx(z,{icon:tt,className:"text-white mr-2"}),"Crear cliente"]})]})]}),ve&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto  h-full min-h-full w-screen flex justify-center justify-items-center align-middle m-auto",children:e.jsxs("div",{className:"flex justify-end min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 transition-opacity","aria-hidden":"true",children:e.jsx("div",{className:"absolute inset-0 bg-gray-950 opacity-80"})}),e.jsx("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",children:e.jsx("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:e.jsx("div",{className:"sm:flex sm:items-start",children:e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:text-left",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",id:"modal-title",children:"Filtrar CLientes"}),e.jsxs("div",{className:"mt-2",children:[e.jsx("input",{type:"text",placeholder:"Ingrese filtro...",className:"w-full py-2 px-3 border border-gray-300 rounded-md mb-2 focus:outline-none focus:border-blue-500 dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600",value:m,onChange:Qe}),e.jsx("button",{onClick:Ge,className:"w-full bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 focus:outline-none focus:bg-blue-600",children:"Aplicar Filtro"})]})]})})})})]})}),e.jsx("div",{className:"flex flex-col mt-6",children:e.jsx("div",{className:"-mx-4 -my-2 sm:-mx-6 lg:-mx-8 ",children:e.jsx("div",{className:"inline-block min-w-full py-2 align-middle md:px-6 lg:px-8 ",children:e.jsx("div",{className:"border border-gray-200 dark:border-gray-700 ",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700 shadow-lg rounded-2xl z-40",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800 rounded-2xl",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"py-3.5 px-4 text-sm  text-left rtl:text-right text-gray-500 dark:text-gray-400 w-1/6",children:e.jsx("div",{className:"flex items-center gap-x-0",children:e.jsx("span",{children:"Teléfono"})})}),e.jsx("th",{scope:"col",className:"px-4 py-3.5 text-sm  text-left rtl:text-right text-gray-500 dark:text-gray-400 max-w-60 min-w-60",children:"Nombre"}),e.jsx("th",{scope:"col",className:"px-4 py-3.5 text-sm  text-left rtl:text-right text-gray-500 dark:text-gray-400 max-w-80 min-w-80",children:"Dirección"}),e.jsx("th",{scope:"col",className:"px-5 py-3.5 text-sm  text-left rtl:text-right text-gray-500 dark:text-gray-400 w-1/6",children:e.jsx("button",{className:"flex items-center gap-x-2",children:e.jsx("span",{children:"Estado"})})}),e.jsx("th",{scope:"col",className:"relative text-sm px-6 py-3 text-gray-500 dark:text-gray-400 w-1/6",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700 rounded-2xl",children:I&&I.map((t,l)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-4 whitespace-nowrap w-1/6",children:e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"ml-0",children:e.jsx("div",{className:"text-sm font-medium text-indigo-600 dark:text-indigo-400",children:t.telefono})})})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400 overflow-hidden text-ellipsis max-w-60 min-w-60 cursor-default",title:t.nombre,children:t.nombre}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400 overflow-hidden text-ellipsis max-w-80 min-w-80 cursor-default",title:t.direccion,children:t.direccion}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap w-1/6",children:e.jsx("span",{className:"px-2 py-0.5 text-xs cursor-default rounded-full "+(t.estadoRegistro=="Activo"?"text-green-800 bg-green-100 dark:text-green-200 dark:bg-green-800":"text-red-800 bg-red-100 dark:text-red-200 dark:bg-red-800"),children:t.estadoRegistro})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm font-medium w-1/6",children:Y("Clientes_Actualizar")&&e.jsx("a",{onClick:()=>He({...t}),className:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-200 cursor-pointer",children:e.jsx(z,{icon:st})})})]},l+"."+t))})]})})})})}),e.jsx("div",{className:"flex justify-center mb-10 mt-5 z-40",children:e.jsx("nav",{"aria-label":"Page navigation example",children:e.jsxs("ul",{className:"flex items-center -space-x-px h-8 text-sm",children:[e.jsx("li",{children:e.jsxs("a",{href:"#",onClick:()=>W(r-1),className:`flex items-center justify-center px-3 h-8 ms-0 leading-tight text-gray-500 bg-white border border-e-0 border-gray-300 rounded-s-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white ${r===0?"pointer-events-none opacity-50":""}`,children:[e.jsx("span",{className:"sr-only",children:"Previous"}),e.jsx("svg",{className:"w-2.5 h-2.5 rtl:rotate-180","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 6 10",children:e.jsx("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 1 1 5l4 4"})})]})}),[...Array(ze-h).keys()].map(t=>e.jsx("li",{children:e.jsx("a",{href:"#",onClick:()=>W(h+t),className:`flex items-center justify-center px-3 h-8 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white ${r===h+t?"font-bold text-indigo-700 dark:text-indigo-500":""}`,children:h+t+1})},h+t)),e.jsx("li",{children:e.jsxs("a",{href:"#",onClick:()=>W(r+1),className:`flex items-center justify-center px-3 h-8 leading-tight text-gray-500 bg-white border border-gray-300 rounded-e-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white ${r===L-1?"pointer-events-none opacity-50":""}`,children:[e.jsx("span",{className:"sr-only",children:"Next"}),e.jsx("svg",{className:"w-2.5 h-2.5 rtl:rotate-180","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 6 10",children:e.jsx("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"m1 9 4-4-4-4"})})]})})]})})}),e.jsx("div",{className:"fixed right-0 z-30 size-11 flex justify-center justify-items-center align-middle m-auto top-[50%]",children:e.jsx("button",{onClick:()=>Be(),className:"bg-blue-500 dark:bg-blue-700 hover:bg-blue-700 dark:hover:bg-blue-800 text-white font-bold py-2 px-4 rounded-l-xl focus:outline-none focus:shadow-outline cursor-pointer",title:"Filtrar",children:e.jsx(z,{icon:at})})})]})}):e.jsx("div",{className:"w-full justify-center",children:e.jsx(dt,{clearFilters:he})}),re&&e.jsx(X,{titulo:"Filtrar información de clientes",status:re,onAccept:We,hasErrors:Pe,children:e.jsx("div",{className:"z-40 flex justify-center flex-auto flex-wrap w-full",children:e.jsxs("div",{className:"max-w-sm h-80 z-40",children:[e.jsx("h3",{className:"text-justify",children:"Escribe al menos una palabra en algun campo para inciar una búsqueda."}),e.jsxs("div",{className:"w-full h-full",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{className:"mt-5  rounded-md h-10 w-[9em] "+(Re?"bg-indigo-600 text-white cursor-pointer hover:bg-indigo-700":"bg-gray-400 text-white cursor-default"),onClick:he,children:[e.jsx(z,{icon:rt,className:"mr-2"}),"Limpiar filtros"]})}),e.jsx(u,{name:"telefono",hasFocus:!0,labelText:"Teléfono del cliente",value:g,setValue:B,type:"number",divAddCss:"mt-5",labelAddCss:g?"text-indigo-600":"text-gray-600 dark:text-gray-400"},"telefono"),e.jsx(u,{name:"nombre",hasFocus:!1,labelText:"Nombre del cliente",value:p,setValue:H,divAddCss:"mt-10",labelAddCss:p?"text-indigo-600":"text-gray-600 dark:text-gray-400"},"nombre"),e.jsx(u,{name:"direccion",hasFocus:!1,labelText:"Dirección del cliente",value:b,setValue:M,divAddCss:"mt-10",labelAddCss:b?"text-indigo-600":"text-gray-600 dark:text-gray-400"},"direccion"),e.jsx(be,{name:"estado",hasFocus:!1,labelText:"Estado del cliente",value:y,setValue:_,options:se,labelAddCss:y?"text-indigo-600":"text-gray-600 dark:text-gray-400",divAddCss:"mt-10"},"estadoCliente"),e.jsx("div",{className:"h-20"})]})]})})},2),le&&e.jsx(X,{titulo:"Editar información de clientes",status:le,onAccept:Xe,hasErrors:Ve,children:e.jsx("div",{className:"z-40 flex justify-start flex-auto flex-wrap w-full",children:e.jsxs("div",{className:"h-80 z-40 w-full",children:[e.jsx("h3",{className:"text-justify",children:"Edita las propiedades del cliente."}),e.jsxs("div",{className:"mt-10 w-full",children:[e.jsx(u,{disabled:!0,hasFocus:!1,type:"number",labelText:"Teléfono del cliente",name:"clientEditTelfono",value:k,setValue:ne,inputAddCss:"text-indigo-600 dark:text-indigo-400 font-bold"},"telefono"),e.jsx(u,{hasFocus:!0,labelText:"Nombre del cliente",name:"clientEditNombre",value:j,setValue:oe,divAddCss:"mt-10",required:!0},"nombreCliente"),e.jsx(u,{hasFocus:!1,labelText:"Dirección del cliente",name:"clientEditDireccion",value:E,setValue:ce,divAddCss:"mt-10",required:!0},"direccionCliente"),e.jsx(be,{hasFocus:!1,labelText:"Estado del cliente",name:"selectEstado",options:se,value:S,setValue:de,required:!0,divAddCss:"mt-10"},"selectEstado")]}),e.jsx("div",{className:"h-20"})]})})},1),ie&&e.jsx(X,{titulo:"Crear un nuevo cliente",status:ie,onAccept:Je,hasErrors:Ie,children:e.jsx("div",{className:"z-40 flex justify-start flex-auto flex-wrap w-full",children:e.jsxs("div",{className:"h-80 z-40 w-full",children:[e.jsx("h3",{className:"text-justify",children:"Suministra todos los campos obligatorios del cliente."}),e.jsxs("div",{className:"mt-10 w-full",children:[e.jsx(u,{disabled:!1,hasFocus:!0,type:"number",labelText:"Teléfono del cliente",name:"crearClientCreateTelfono",value:A,setValue:ue,inputAddCss:"text-indigo-600 dark:text-indigo-400 font-bold",required:!0},"crearTelefono"),e.jsx(u,{hasFocus:!1,labelText:"Nombre del cliente",name:"crearClientCreateNombre",value:C,setValue:xe,divAddCss:"mt-10",required:!0},"crearNombreCliente"),e.jsx(u,{hasFocus:!1,labelText:"Dirección del cliente",name:"crearClientCreateDireccion",value:F,setValue:me,divAddCss:"mt-10",required:!0},"crearDireccionCliente")]}),e.jsx("div",{className:"h-20"})]})})},1)]}):e.jsx(ge,{to:"/administracion/inicio"}):e.jsx(ge,{to:"/ingresar"})}const gt=()=>e.jsx("div",{className:"w-full justify-center flex flex-wrap flex-auto",children:e.jsx(ht,{},"clientesAdmin")}),Et=()=>e.jsx(e.Fragment,{children:e.jsx(gt,{})});export{Et as default};
